<html>
  <head>
    <link rel="stylesheet" href="style.css" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script><!--understand the use of this -->
  </head>
  <body>
    <table class="page_tbl">
      <tr>
        <td align="center" id="page_cell1">
          <h1 class="before_otp">Sign up</h1>
            <table cellspacing="10px">

              <tr>
                <td class="labl before_otp">E-mail:</td>
                <td>
                  <input type="email" name="email" id="email" class="inp_field before_otp" />
                </td>
                <td><button class="btn before_otp" onclick="send_otp()">Get OTP</button></td>
              </tr>

              <tr class="after_get_otp">
                <td class="labl">OTP:</td>
                <td><input type="text" name="otp" id="otp" class="inp_field"></td>
                <td><button class="btn" onclick="check_otp()">GO</button></td>
              </tr>



              <tr class="after_get_otp">
                <td colspan="3"  id="prompt" class="labl" style="text-align:center;"></td>
              </tr>



              <tr class="after_go">
                <td class="labl">First Name:</td>
                <td colspan="2">
                  <input type="text" name="fname" id="fname" class="inp_field" />
                </td>
              </tr>



              <tr class="after_go">
                <td class="labl">Last Name:</td>
                <td colspan="2">
                  <input type="text" name="lname" id="lname" class="inp_field" />
                </td>
              </tr>



              <tr class="after_go">
                <td class="labl">Date Of Birth:</td>
                <td colspan="2">
                  <select name="day" id="dob1" class="inp_field">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                    <option value="16">16</option>
                    <option value="17">17</option>
                    <option value="18">18</option>
                    <option value="19">19</option>
                    <option value="20">20</option>
                    <option value="21">21</option>
                    <option value="22">22</option>
                    <option value="23">23</option>
                    <option value="24">24</option>
                    <option value="25">25</option>
                    <option value="26">26</option>
                    <option value="27">27</option>
                    <option value="28">28</option>
                    <option value="29">29</option>
                    <option value="30">30</option>
                    <option value="31">31</option>
                  </select>
                  <select name="month" id="dob2" class="inp_field">
                    <option value="1">January</option>
                    <option value="2">Febuary</option>
                    <option value="3">March</option>
                    <option value="4">April</option>
                    <option value="5">May</option>
                    <option value="6">June</option>
                    <option value="7">July</option>
                    <option value="8">August</option>
                    <option value="9">Septmber</option>
                    <option value="10">October</option>
                    <option value="11">November</option>
                    <option value="12">December</option>
                  </select>
                  <select name="year" id="dob3" class="inp_field">
                    <option value="1999">1999</option>
                    <option value="2000">2000</option>
                    <option value="2001">2001</option>
                    <option value="2002">2002</option>
                    <option value="2003">2003</option>
                    <option value="2004">2004</option>
                    <option value="2005">2005</option>
                    <option value="2006">2006</option>
                    <option value="2007">2007</option>
                    <option value="2008">2008</option>
                    <option value="2009">2009</option>
                    <option value="2010">2010</option>
                    <option value="2011">2011</option>
                    <option value="2012">2012</option>
                    <option value="2013">2013</option>
                    <option value="2014">2014</option>
                    <option value="2015">2015</option>
                    <option value="2016">2016</option>
                    <option value="2017">2017</option>
                    <option value="2018">2018</option>
                    <option value="2019">2019</option>
                    <option value="2020">2020</option>
                  </select>
                </td>
              </tr>



              <tr class="after_go">
                <td class="labl">Gender:</td>
                <td colspan="2">
                  <input type="radio" id="gender" value="male" name="gender" />Male
                  <input type="radio" id="gender" value="female" name="gender" />Female
                </td>
              </tr>

              <!--
              <tr class="after_go">
                <td class="labl">Aadhar No:</td>
                <td colspan="2">
                  <input type="text" name="aadhar" id="aadhar" class="inp_field" />
                </td>
              </tr>-->



              <tr class="after_go">
                <td class="labl">Phone No:</td>
                <td colspan="2">
                  <input type="text" name="phno" id="phno" class="inp_field" />
                </td>
              </tr>
              

              <tr class="after_go">
                <td class="labl">Address:</td>
                <td colspan="2">
                  <input type="text" name="address" id="address" class="inp_field" />
                </td>
              </tr>


              <!--
              <tr class="after_go">
                <td colspan="3" align="center">
                  <button class="btn" onclick="show_services()">Select Services</button>
                </td>
              </tr>-->



            </table>
        </td>
        <td class="page_cell2">
          <div id="start_img"></div>
          <div id="select_service">
            <p align="center" style="color: #000; font-size:25px;">Select Services to start:</p>
            <label for="Internet" class="labl2">Internet :</label><br>
            <input type="radio" class="radio_btn" name="internet" id="internet" value="0"><span class="r_option">Don't want to avail service  </span><br>
            <input type="radio" class="radio_btn" name="internet" id="internet" value="1"><span class="r_option">Pack 1:  200 GB FUP    100 Mbps upload/download speed  Rs.500.00 per month </span><br>
            <input type="radio" class="radio_btn" name="internet" id="internet" value="2"><span class="r_option">Pack 2: 1200 GB FUP   1000 Mbps upload/download speed  Rs.1000.00 per month </span><br>
            <br>
            <br>
            <label for="cabletv" class="labl2">Cable TV :</label><br>
            <input type="radio" class="radio_btn" name="cabletv" id="cabletv" value="0"><span class="r_option">Don't want to avail the service</span><br>
            <input type="radio" class="radio_btn" name="cabletv" id="cabletv" value="1"><span class="r_option">Pack 1: Basic, Essential, Free channels  Rs.300.00 per month </span><br>
            <input type="radio" class="radio_btn" name="cabletv" id="cabletv" value="2"><span class="r_option">Pack 2: All Paid channels Rs.600.00 per month</span><br>
            <br>
            <br>
            <label for="lpg" class="labl2">LPG to Home :</label><br>
            <input type="radio" class="radio_btn" name="lpg" id="lpg" value="0"><span class="r_option">Don't want to avail the service</span><br>
            <input type="radio" class="radio_btn" name="lpg" id="lpg" value="1"><span class="r_option">Start Service for Rs.350.00 per month</span><br>
            <br>
            <br>
            <label for="electricity" class="labl2">Electricity :</label><br>
            <input type="radio" class="radio_btn" name="electricity" id="electricity" value="0"><span class="r_option">Don't want to avail the service</span><br>
            <input type="radio" class="radio_btn" name="electricity" id="electricity" value="1"><span class="r_option">Start Service for Rs.500.00 per month</span><br>
            <br>
            <br>
            <center><button class="btn" align="center" id="sub_btn" onclick="sub_data()">Confirm Submit</button></center>
          </div>
          <div id="end_prompt">
            
          </div>
          
        </td>
      </tr>
    </table>
    <script>
      var i,otp,email;
      ele_after_get_otp=document.getElementsByClassName("after_get_otp");
      for(i=0;i<ele_after_get_otp.length;i++)
      {
        ele_after_get_otp[i].style.display="none";
      }
      ele_after_go=document.getElementsByClassName("after_go");
      for(i=0;i<ele_after_go.length;i++)
      {
        ele_after_go[i].style.display="none";
      }
      document.getElementById("select_service").style.display="none";
      document.getElementById("end_prompt").style.display="none";
      function validateEmail(email) 
      {
        console.log("here e v",email)
        const re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(email);
      }
            // DO AFTER CLICKING THE GET OTP BUTTON
      function send_otp()
      {
        //var email=jQuery('#email').val();
        email=document.getElementById('email').value;
        if(validateEmail(email))
        {
          otp=Math.floor((Math.random()*99999)+11111);
          var call=$.ajax({
                    url:'otp.php',
                    type:'post',
                    async:false,
                    data:{email:email, status:1,otp:otp},
                    success:function(result)
                    {
                        //console.log(result);
                        //setInterval('location.reload(false)');
                    }
                  });
                  console.log(call.responseText);
          document.getElementById("prompt").innerHTML="Check E-mail for OTP";
          document.getElementById("prompt").style.color="#fff"
          for(i=0;i<ele_after_get_otp.length;i++)
          {
            ele_after_get_otp[i].style.display="table-row";
          }
          document.getElementById("otp").value='';
        }
        else
        {
          document.getElementById("prompt").innerHTML="INVALID E-mail Try Again";
          document.getElementById("prompt").style.color="#f00"
          ele_after_get_otp[1].style.display="table-row";
        }
        
      }
      
      //DO AFTER GO BUTTON
      function check_otp()
      {
        var chk_otp=document.getElementById("otp").value;
        console.log(otp,chk_otp);

        if(otp==chk_otp)
        {
          var call=$.ajax({
                    url:'otp.php',
                    type:'post',
                    async:false,
                    data:{email:email, status:2,otp:chk_otp},
                    success:function(result)
                    {
                        //console.log(result);
                        //setInterval('location.reload(false)');
                    }
                  });
          console.log(call.responseText);
          if(call.responseText=="fail")
          {
            document.getElementById("prompt").innerHTML="OTP Expired! Click get OTP for a new OTP";
            document.getElementById("prompt").style.color="#f00" 
          }
          else
          {
            document.getElementById("prompt").style.display="none";
            for(i=0;i<ele_after_go.length;i++)
            {
              ele_after_go[i].style.display="table-row";
            }
            document.getElementById("select_service").style.display="block";
          }
        }
        else
        {
          document.getElementById("prompt").innerHTML="INVALID OTP Try Again";
          document.getElementById("prompt").style.color="#f00"
        }
      }


      // AFTER TAKING IN FULL DATA 
      function sub_data()
      {
        var ele,fname,lname,dob,gender,phno,address,internet,cabletv,lpg,electricity;
        var uid=Math.floor((Math.random()*99999)+11111);
        fname=document.getElementById("fname").value;
        lname=document.getElementById("lname").value;
        dob=document.getElementById("dob3").value+"-"+document.getElementById("dob2").value+"-"+document.getElementById("dob1").value;
        gender=document.getElementById("gender").value;
        phno=document.getElementById("phno").value;
        address=document.getElementById("address").value;        
        ele=document.getElementsByName("internet");
        for(var i=0;i<ele.length;i++){
          if(ele[i].checked){
            internet=ele[i].value;
          }
        }
        ele=document.getElementsByName("cabletv");
        for(var i=0;i<ele.length;i++){
          if(ele[i].checked){
            cabletv=ele[i].value;
          }
        }
        ele=document.getElementsByName("lpg");
        for(var i=0;i<ele.length;i++){
          if(ele[i].checked){
            lpg=ele[i].value;
          }
        }
        ele=document.getElementsByName("electricity");
        for(var i=0;i<ele.length;i++){
          if(ele[i].checked){
            electricity=ele[i].value;
          }
        }
        var call=$.ajax(
          {
            url:'insert_dbms.php',
            type:'post',
            data:{email:email,uid:uid,fname:fname,lname:lname,dob:dob
              ,gender:gender,phno:phno,address:address,internet:internet
              ,cabletv:cabletv,lpg:lpg,electricity:electricity}
          }
        );
        console.log(email,fname,lname,dob,gender,phno,address,internet,cabletv,lpg,electricity);
        ele_after_get_otp=document.getElementsByClassName("after_get_otp");
        for(i=0;i<ele_after_get_otp.length;i++)
        {
          ele_after_get_otp[i].style.display="none";
        }
        ele_after_go=document.getElementsByClassName("after_go");
        for(i=0;i<ele_after_go.length;i++)
        {
          ele_after_go[i].style.display="none";
        }
        var ele_before_otp =document.getElementsByClassName("before_otp");
        for(var i=0;i<ele_before_otp.length;i++)
        {
          ele_before_otp[i].style.display="none";
        }
        document.getElementById("select_service").style.display="none";
        document.getElementById("end_prompt").innerHTML="Thank You<br>for<br> Signing Up <br> Please make note of your UID <br> UID:"+uid;
        document.getElementById("end_prompt").style.display="block";


      }

    </script>
  </body>
</html>